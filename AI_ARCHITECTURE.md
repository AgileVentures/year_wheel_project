# AI Assistant Architecture Diagram

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      Year Wheel Application                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

                              USER
                                โ
                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         Header.jsx                               โ
โ                                                                   โ
โ   [Logo] [Menu] [Pages]         [AI Button] [History] [Save]   โ
โ                                      โ                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                       โ
                                       โ onClick โ setIsAIOpen(true)
                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      AIAssistant.jsx                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  Header: "AI Assistent" ๐ซ                           [X]  โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค โ
โ  โ  Messages:                                                 โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ  โ AI: "Hej! Vad vill du gรถra?"                        โ โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ  โ User: "Skapa en ring fรถr mina projekt" โ           โ โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ  โ AI: "โ Ring skapad!"                                โ โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค โ
โ  โ  Input: [Type here...] [Send โ]                          โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
                   โ handleSubmit()
                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  Vercel AI SDK (streamText)                      โ
โ                                                                   โ
โ  โข Streams responses in real-time                               โ
โ  โข Executes tools as needed                                     โ
โ  โข Handles multi-step operations                                โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โ API call with tools
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     OpenAI GPT-4 Turbo                           โ
โ                                                                   โ
โ  โข Understands Swedish prompts                                  โ
โ  โข Decides which tools to use                                   โ
โ  โข Generates natural responses                                  โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โ Returns tool calls
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   aiWheelService.js                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Tool Functions:                                         โ   โ
โ  โ  โข aiCreateRing(wheelId, {name, type, color})          โ   โ
โ  โ  โข aiCreateActivityGroup(wheelId, {name, color})       โ   โ
โ  โ  โข aiCreateItem(wheelId, {name, dates, ringId...})    โ   โ
โ  โ  โข aiCreatePage(wheelId, {year, copyStructure})       โ   โ
โ  โ  โข aiAnalyzeWheel(wheelId)                            โ   โ
โ  โ  โข aiDeleteRing(wheelId, {ringId})                    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โ Calls existing services
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      wheelService.js                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  CRUD Operations:                                        โ   โ
โ  โ  โข fetchWheel(wheelId)                                  โ   โ
โ  โ  โข saveWheelData(wheelId, orgData)                     โ   โ
โ  โ  โข updateWheel(wheelId, updates)                       โ   โ
โ  โ  โข createPage(wheelId, pageData)                       โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โ Database operations
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     Supabase PostgreSQL                          โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Tables:                                                 โ   โ
โ  โ  โข year_wheels                                          โ   โ
โ  โ  โข wheel_rings                                          โ   โ
โ  โ  โข activity_groups                                      โ   โ
โ  โ  โข labels                                               โ   โ
โ  โ  โข items                                                โ   โ
โ  โ  โข wheel_pages                                          โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โ Realtime updates
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    App.jsx (WheelEditor)                         โ
โ                                                                   โ
โ  โข loadWheelData() - Refreshes wheel from DB                    โ
โ  โข Auto-updates UI after AI changes                             โ
โ  โข Realtime sync with other users                               โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โ Updates state
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       YearWheel.jsx                              โ
โ                                                                   โ
โ  โข Renders updated wheel with new rings/activities              โ
โ  โข Canvas-based circular calendar visualization                 โ
โ  โข Shows user's changes instantly                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Data Flow Example: "Skapa en ring fรถr projekt"

```
1. User types in AIAssistant
   โ
2. streamText() sends to OpenAI with context:
   {
     "Current wheel": {
       "rings": 2,
       "activityGroups": 3,
       "items": 5
     }
   }
   โ
3. GPT-4 responds:
   "Jag skapar en ring..."
   TOOL_CALL: createRing({name: "Projekt", type: "outer"})
   โ
4. aiCreateRing() executes:
   - Fetches current wheel data
   - Creates new ring object
   - Assigns color from palette
   - Saves to database via saveWheelData()
   โ
5. Database updated:
   INSERT INTO wheel_rings (wheel_id, name, type, color, ...)
   โ
6. onWheelUpdate() callback:
   - Triggers loadWheelData()
   - Fetches fresh wheel data
   - Updates React state
   โ
7. YearWheel re-renders:
   - New ring appears on canvas
   - User sees instant update
   โ
8. AI confirms:
   "โ Ring 'Projekt' skapad!"
```

## Component Hierarchy

```
App.jsx
โโโ Header.jsx
โ   โโโ AI Button (toggles AIAssistant)
โโโ OrganizationPanel.jsx
โ   โโโ Rings/Activities management UI
โโโ YearWheel.jsx
โ   โโโ Canvas rendering
โโโ AIAssistant.jsx โ NEW!
    โโโ Floating Button
    โโโ Chat Window
    โ   โโโ Messages List
    โ   โโโ Tool Indicators
    โ   โโโ Input Form
    โโโ AI Logic
        โโโ streamText()
        โโโ Tool Definitions
        โโโ Tool Execution
```

## API Key Flow (Security)

```
Developer
  โ
  โ 1. Gets API key from OpenAI
  โ
.env.local
  VITE_OPENAI_API_KEY=sk-...
  โ
  โ 2. Vite injects at build time
  โ
Browser (import.meta.env.VITE_OPENAI_API_KEY)
  โ
  โ 3. Passed to OpenAI SDK
  โ
OpenAI API
  โ
  โ 4. Validates & processes
  โ
Response streamed back to browser
```

**Note**: For production, move API key to Supabase Edge Function
to keep it server-side and secure.

## Technology Stack

- **Frontend**: React 18 + Vite
- **AI SDK**: Vercel AI SDK (@ai-sdk)
- **AI Model**: OpenAI GPT-4 Turbo
- **Validation**: Zod
- **Database**: Supabase PostgreSQL
- **Styling**: Tailwind CSS
- **Icons**: Lucide React
- **State**: React hooks + context

## Performance Characteristics

- **First Response**: ~1-2 seconds
- **Streaming**: 20-50 tokens/second
- **Tool Execution**: 0.5-2 seconds
- **Database Update**: 200-500ms
- **Total (creation flow)**: 3-5 seconds

## Cost Breakdown

```
Per Conversation:
โโโ Prompt (~500 tokens ร $0.01/1K) = $0.005
โโโ Response (~300 tokens ร $0.03/1K) = $0.009
โโโ Total: ~$0.014

Per Tool Call:
โโโ Extra tokens (~200) = $0.006
โโโ Total with tool: ~$0.020

Monthly (100 conversations):
โโโ Basic chat: $1.40
โโโ With tools: $2.00
โโโ Heavy use: $5-10
```

Very affordable! ๐
